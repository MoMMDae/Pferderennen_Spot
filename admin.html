<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Admin â€“ Vertriebsrennen (Datenpflege)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
    h1{ text-align:center; margin-bottom:20px; }
    .container{ max-width:900px; margin:0 auto; }
    .form-section{ background:white; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,.15); }
    textarea{ width:100%; height:200px; font-family:monospace; margin-top:10px; }
    button{ padding:10px 14px; font-size:16px; }
    #status{ margin-left:12px; color:green; font-weight:600; }
    .hint{ font-size:13px; color:#666; margin-top:8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ”§ Admin: Vertriebsrennen â€” Datenpflege</h1>

    <div class="form-section">
      <form id="inputForm">
        <label>Monat auswÃ¤hlen:
          <select id="month">
            <option>September</option>
            <option>Oktober</option>
            <option>November</option>
            <option>Dezember</option>
          </select>
        </label>

        <p class="hint">VerkÃ¤ufe: Format = <code>Name;Wert</code> pro Zeile (z. B. <code>Enes;20</code>)</p>

        <textarea id="salesInput" placeholder="Enes;20
Florian;40
Philipp;12
..."></textarea>

        <br><br>
        <button type="submit">ðŸ’¾ Daten speichern</button>
        <span id="status"></span>
      </form>

      <p class="hint">Hinweis: Ã„nderungen werden sofort an alle geÃ¶ffneten Viewer (index.html) Ã¼bertragen.</p>
    </div>
  </div>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // ======= FIREBASE KONFIG - ERSETZE DIESE WERTE MIT DEINEN =======
    const firebaseConfig = {
      apiKey: "DEIN_API_KEY",
      authDomain: "DEIN_PROJEKT.firebaseapp.com",
      projectId: "DEIN_PROJEKT",
      storageBucket: "DEIN_PROJEKT.appspot.com",
      messagingSenderId: "DEIN_SENDER_ID",
      appId: "DEINE_APP_ID"
    };
    // ===============================================================

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const form = document.getElementById('inputForm');
    const status = document.getElementById('status');

    form.addEventListener('submit', async function(e){
      e.preventDefault(); // verhindert reload
      status.style.color = 'black';
      status.innerText = 'Speichert...';

      const month = document.getElementById('month').value;
      const raw = document.getElementById('salesInput').value.trim();
      const sales = {};

      raw.split('\n').forEach(line => {
        const parts = line.split(';');
        if(parts.length >= 2){
          const name = parts[0].trim();
          const val = parseFloat(parts[1].trim());
          if(name) sales[name] = isNaN(val) ? 0 : val;
        }
      });

      try {
        await db.collection('sales').doc('current')
          .set({ month, sales, updatedAt: firebase.firestore.FieldValue.serverTimestamp() });
        status.style.color = 'green';
        status.innerText = 'Gespeichert âœ“';
      } catch (err) {
        console.error('Speichern fehlgeschlagen', err);
        status.style.color = 'red';
        status.innerText = 'Fehler beim Speichern';
      }

      setTimeout(()=> status.innerText = '', 2500);
    });
  </script>
</body>
</html>
